(function(){"use strict";function a(a,b,c){function d(a){var b=window.getComputedStyle(a),c=function(a){return parseInt(b.getPropertyValue(a).replace("px",""))||0};return{left:a.getBoundingClientRect().left+c("padding-left"),top:a.getBoundingClientRect().top+c("padding-top")}}function e(a){v=!1,n.removeEventListener("mousemove",j),n.removeEventListener("mouseup",i),t.length?setTimeout(function(){r=t[t.length-1],p.addEventListener("mousedown",h)},0):r=null}function f(a){if(0!=a.data.enter.nodes.length){var b=a.data.enter.nodes[0];u[b.id]||(t.push(b),u[b.id]=!0,v||(r=t[t.length-1],p.addEventListener("mousedown",h)))}}function g(a){if(0!=a.data.leave.nodes.length){var b=a.data.leave.nodes[0],c=t.map(function(a){return a}).indexOf(b);t.splice(c,1),delete u[b.id],t.length&&!v?r=t[t.length-1]:p.removeEventListener("mousedown",h)}}function h(a){z&&3!=a.which&&(v=!0,r&&l.graph.nodes().length>0&&(y=!0,p.removeEventListener("mousedown",h),n.addEventListener("mousemove",j),n.addEventListener("mouseup",i),o.settings({mouseEnabled:!1,enableHovering:!1}),k.dispatchEvent("startdrag",{node:r,captor:a,renderer:o})))}function i(a){if(v=!1,p.addEventListener("mousedown",h),n.removeEventListener("mousemove",j),n.removeEventListener("mouseup",i),o.settings({mouseEnabled:!0,enableHovering:!0}),x){if(k.dispatchEvent("drop",{node:r,captor:a,renderer:o}),m)for(var b=m.nodes(),c=0;c<b.length;c++)delete b[c].alphaX,delete b[c].alphaY;l.refresh()}k.dispatchEvent("dragend",{node:r,captor:a,renderer:o}),x=!1,r=null}function j(a){function b(){var b,c,e,f,g,h,i,j=d(o.container),n=a.clientX-j.left,p=a.clientY-j.top,t=Math.cos(o.camera.angle),u=Math.sin(o.camera.angle),v=l.graph.nodes(),w=[];if(z&&!(v.length<2)&&(i=sigma.utils.getDistance(n,p,r[q+"x"],r[q+"y"]),!(y&&i<r[q+"size"]))){y=!1;for(var A=0;z&&(f=v[A],f&&(g={x:f.x*t+f.y*u,y:f.y*t-f.x*u,renX:f[q+"x"],renY:f[q+"y"]},w.push(g)),A!=v.length-1);A++)if(A>0){if(w[0].x!=w[1].x&&w[0].y!=w[1].y)break;w.pop()}var B=w[0],C=w[1],D=C.renX-B.renX;0===D&&(D=1);var E=C.renY-B.renY;if(0===E&&(E=1),n=(n-B.renX)/D*(C.x-B.x)+B.x,p=(p-B.renY)/E*(C.y-B.y)+B.y,b=n*t-p*u,c=p*t+n*u,m&&(e=m.nodes(),h=-1<e.map(function(a){return a.id}).indexOf(r.id)))for(var A=0;A<e.length;A++)s!=r&&(e[A].alphaX=null,e[A].alphaY=null),e[A].alphaX&&e[A].alphaY||(e[A].alphaX=e[A].x-n,e[A].alphaY=e[A].y-p),e[A].x=r.x+e[A].alphaX,e[A].y=r.y+e[A].alphaY;r.x=b,r.y=c,l.refresh({skipIndexation:!0}),x=!0,k.dispatchEvent("drag",{node:r,captor:a,renderer:o}),s=r}}if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){clearTimeout(c);var c=setTimeout(b,0)}else b()}if(sigma.classes.dispatcher.extend(this),sigma.renderers.webgl&&b instanceof sigma.renderers.webgl)throw new Error("The sigma.plugins.dragNodes is not compatible with the WebGL renderer");var k=this,l=a,m=c,n=document.body,o=b,p=b.container.lastChild,q=b.options.prefix,r=null,s=null,t=[],u={},v=!1,w=!1,x=!1,y=!0,z=!0;b instanceof sigma.renderers.svg&&(p=b.container.firstChild),b.bind("hovers",f),b.bind("hovers",g),b.bind("click",e),this.enable=function(){z=!0},this.disable=function(){z=!1,r=null,s=null,t=[],u={},v=!1,w=!1,x=!1,y=!0},this.unbindAll=function(){p.removeEventListener("mousedown",h),n.removeEventListener("mousemove",j),n.removeEventListener("mouseup",i),o.unbind("hovers",f),o.unbind("hovers",g)}}if("undefined"==typeof sigma)throw"sigma is not declared";sigma.utils.pkg("sigma.plugins");var b={};sigma.plugins.dragNodes=function(c,d,e){return b[c.id]||(b[c.id]=new a(c,d,e)),c.bind("kill",function(){sigma.plugins.killDragNodes(c)}),c.bind("animate.start",function(){b[c.id].disable()}),c.bind("animate.end",function(){b[c.id].enable()}),b[c.id]},sigma.plugins.killDragNodes=function(c){b[c.id]instanceof a&&(b[c.id].unbindAll(),delete b[c.id])}}).call(window);
//# sourceMappingURL=sigma.plugins.dragNodes.min.js.map